os: linux
language: python
dist: bionic
services:
  - docker
jobs:
  include:
    - python: 3.6
      env: DISTRIB="conda" PYTHON_VERSION="3.6" COVERAGE="true"
install:
  - source tests/travis_install.sh
  - pip install -r requirements.txt
  - pip install twine
  - pip install .
before_script:
  - git config --global user.email "support@travis-ci.org"
  - git config --global user.name "Travis"
script:
  - coverage run --source=cpac setup.py test
after_success:
  - if [[ "$COVERAGE" == "true" ]]; then coveralls || echo "failed"; fi
  - bash .travis/update_README_usage.sh
  - '[ "${TRAVIS_PULL_REQUEST}" = "true" ] && bash .travis/deploy_to_pypi.sh'
after_script:
  - travis-cleanup
cache:
  pip: true
  directories:
    - $HOME/miniconda
