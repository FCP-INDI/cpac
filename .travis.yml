os: linux
language: go
dist: bionic
go:
  - "1.14"
services:
  - docker
addons:
  apt:
    packages:
      - flawfinder
      - squashfs-tools
      - uuid-dev
      - libuuid1
      - libffi-dev
      - libssl-dev
      - libssl1.0.0
      - libarchive-dev
      - libgpgme11-dev
      - libseccomp-dev
matrix:
  include:
    - go: "1.14"
    - python: "3.6"
before_install:
  - virtualenv -p /usr/bin/python3 cpac_python
  - source cpac_python/bin/activate
  - sudo chmod u+x .travis/*.sh
  - /bin/bash .travis/setup.sh
install:
  - source tests/travis_install.sh
  - pip install -r requirements.txt
  - pip install twine
  - pip install .
before_script:
  - git config --global user.email "support@travis-ci.org"
  - git config --global user.name "Travis"
script:
  - coverage run --source=cpac setup.py test
after_success:
  - if [[ "$COVERAGE" == "true" ]]; then coveralls || echo "failed"; fi
  - bash .travis/update_README_usage.sh
  - '[ "${TRAVIS_PULL_REQUEST}" = "true" ] && bash .travis/deploy_to_pypi.sh'
after_script:
  - travis-cleanup
cache:
  pip: true
  directories:
    - $HOME/miniconda
